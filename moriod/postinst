#!/bin/bash
# Post-Install script for moriod

set -e


# Force the correct version
PACKAGE_VERSION=$(dpkg-query -W -f='${Version}' "moriod")
echo $PACKAGE_VERSION > /etc/morio/moriod/version
tee /etc/morio/moriod/version.env > /dev/null <<EOF
#
# This file is auto-generated by the moriod software package.
# Under normal circumstances, you should not edit it.
#
# This file holds the MORIO_VERSION variable, which controls the docker tag
# systemd will start. It is installed/provided by the moriod package and
# will be updated when you update the package.
#

MORIO_VERSION=${PACKAGE_VERSION}
EOF


# Reload systemd
systemctl daemon-reload || true

# Enable services
systemctl enable docker || true
systemctl enable moriod || true

# Start services
systemctl start docker || true
systemctl start moriod || true

